<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Almacén del Repostero v24</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 10px; }
        .metodo-btn.active { border-color: #3b82f6; background-color: #eff6ff; transform: scale(1.05); }
    </style>
</head>
<body class="bg-gray-100 h-screen flex overflow-hidden font-sans text-gray-800">

    <div class="w-64 bg-white shadow-xl flex flex-col z-20">
        <div class="p-6 text-center border-b border-gray-50">
            <h1 class="text-xl font-black text-blue-600 leading-tight uppercase tracking-tighter">El Almacén <br>del Repostero</h1>
            <p class="text-[9px] text-gray-400 font-bold mt-1 uppercase italic">Sarmiento 2201</p>
        </div>
        <nav class="flex-1 px-4 space-y-1 mt-4">
            <button onclick="showSection('pos')" class="w-full flex items-center p-3 hover:bg-blue-50 rounded-xl transition font-bold text-gray-600"><i class="fas fa-cash-register mr-3 text-blue-500"></i> Ventas</button>
            <button onclick="accesoProtegido('inventory')" class="w-full flex items-center p-3 hover:bg-blue-50 rounded-xl transition font-bold text-gray-600"><i class="fas fa-boxes mr-3 text-blue-500"></i> Inventario</button>
            <button onclick="accesoProtegido('reports')" class="w-full flex items-center p-3 hover:bg-blue-50 rounded-xl transition font-bold text-gray-600"><i class="fas fa-file-invoice-dollar mr-3 text-blue-500"></i> Reportes y Cierre</button>
        </nav>
        <div class="p-4 border-t border-gray-50">
            <p class="text-[8px] text-center text-gray-300 font-black uppercase tracking-widest">Marcos Paz - 2026</p>
        </div>
    </div>

    <div class="flex-1 flex flex-col overflow-hidden">
        <header class="bg-white p-4 shadow-sm border-b flex justify-between items-center px-8">
            <div class="relative w-96">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                <input type="text" id="buscador" onkeyup="filtrarProductos()" placeholder="Buscar producto..." class="w-full pl-10 pr-4 py-2 border rounded-xl outline-none focus:ring-2 focus:ring-blue-500 font-bold">
            </div>
            <div id="reloj" class="font-black text-gray-400 text-sm"></div>
        </header>
        <main id="main-content" class="flex-1 p-6 overflow-y-auto bg-gray-50"></main>
    </div>

    <script>
        // ==========================================
        // CONFIGURACIÓN DE SEGURIDAD
        // ==========================================
        const CLAVE_MAESTRA = "Mupirata1"; 
        const MAIL_RECUPE = "cristianjaviergoncalves@gmail.com";
        // ==========================================

        let productos = JSON.parse(localStorage.getItem('productos')) || [];
        let historialVentas = JSON.parse(localStorage.getItem('historial_ventas')) || [];
        let gastos = JSON.parse(localStorage.getItem('gastos')) || [];
        let carrito = [];
        let filtroActual = "";
        let metodoPagoActual = "Efectivo";

        function accesoProtegido(seccion) {
            const pass = prompt("ACCESO RESTRINGIDO\nIngrese clave de administrador:");
            if (pass === CLAVE_MAESTRA) {
                showSection(seccion);
            } else if (pass !== null) {
                alert(`CLAVE INCORRECTA.\n\nSi olvidó su contraseña, solicítela a:\n${MAIL_RECUPE}`);
            }
        }

        function showSection(name) {
            const container = document.getElementById('main-content');
            if (name === 'pos') renderPOS(container);
            if (name === 'inventory') renderInventory(container);
            if (name === 'reports') renderReports(container);
        }

        // --- VENTAS (POS) ---
        function setMetodo(metodo) {
            metodoPagoActual = metodo;
            document.querySelectorAll('.metodo-btn').forEach(b => b.classList.remove('active', 'ring-2', 'ring-blue-500'));
            event.currentTarget.classList.add('active', 'ring-2', 'ring-blue-500');
        }

        function renderPOS(container) {
            const filtrados = productos.filter(p => p.nombre.toLowerCase().includes(filtroActual));
            container.innerHTML = `
                <div class="flex gap-6 h-full">
                    <div class="flex-1 grid grid-cols-2 lg:grid-cols-3 gap-4 content-start overflow-y-auto pr-2">
                        ${filtrados.map(p => `
                            <div onclick="agregarAlCarrito(${p.id})" class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 hover:border-blue-500 cursor-pointer transition active:scale-95">
                                <h3 class="font-black text-[10px] uppercase text-gray-500">${p.nombre}</h3>
                                <p class="text-blue-600 font-black text-xl">$${p.precio.toFixed(2)}</p>
                                <p class="text-[9px] font-bold text-gray-300 uppercase italic">Stock: ${p.stock}</p>
                            </div>`).join('')}
                    </div>
                    <div class="w-96 bg-white rounded-[32px] shadow-xl p-6 flex flex-col border border-blue-50">
                        <div id="cart-list" class="flex-1 overflow-y-auto space-y-2 mb-4 pt-4"></div>
                        <div class="pt-4 border-t border-dashed bg-gray-50 p-4 rounded-2xl space-y-3">
                            <div class="flex justify-between items-center text-2xl font-black text-blue-900"><span>TOTAL</span><span id="total-txt">$0.00</span></div>
                            <div class="grid grid-cols-3 gap-2 py-2">
                                <button onclick="setMetodo('Efectivo')" class="metodo-btn active ring-2 ring-blue-500 p-2 border rounded-xl bg-white text-[8px] font-black uppercase flex flex-col items-center transition shadow-sm"><i class="fas fa-money-bill-wave text-green-500 mb-1"></i>Efectivo</button>
                                <button onclick="setMetodo('Transferencia')" class="metodo-btn p-2 border rounded-xl bg-white text-[8px] font-black uppercase flex flex-col items-center transition shadow-sm"><i class="fas fa-university text-blue-500 mb-1"></i>Transf.</button>
                                <button onclick="setMetodo('Tarjeta')" class="metodo-btn p-2 border rounded-xl bg-white text-[8px] font-black uppercase flex flex-col items-center transition shadow-sm"><i class="fas fa-credit-card text-red-500 mb-1"></i>Tarjeta</button>
                            </div>
                            <div class="grid grid-cols-2 gap-2 mt-2">
                                <button onclick="procesarVenta(true)" class="bg-blue-600 text-white py-3 rounded-xl font-black text-[9px] uppercase shadow-lg hover:bg-blue-700 transition">Ticket</button>
                                <button onclick="procesarVenta(false)" class="bg-gray-800 text-white py-3 rounded-xl font-black text-[9px] uppercase shadow-lg hover:bg-black transition">Cobrar</button>
                            </div>
                        </div>
                    </div>
                </div>`;
            renderCart();
        }

        function agregarAlCarrito(id) {
            const p = productos.find(x => x.id === id);
            if(p.stock <= 0) { alert("¡Sin Stock!"); return; }
            const itemExistente = carrito.find(x => x.id === id);
            if (itemExistente) { itemExistente.cantidad = parseFloat((itemExistente.cantidad + 1).toFixed(2)); } 
            else { carrito.push({ ...p, cantidad: 1 }); }
            renderCart();
        }

        function renderCart() {
            const list = document.getElementById('
