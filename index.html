<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Almacén v29 - Totales Históricos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 10px; }
        .metodo-btn.active { transform: scale(1.05); }
        input:focus { border-color: #3b82f6; outline: none; }
    </style>
</head>
<body class="bg-gray-100 h-screen flex overflow-hidden font-sans text-gray-800">

    <div class="w-64 bg-white shadow-xl flex flex-col z-20">
        <div class="p-6 text-center border-b border-gray-50">
            <h1 class="text-xl font-black text-blue-600 leading-tight uppercase tracking-tighter">El Almacén <br>del Repostero</h1>
            <p class="text-[9px] text-gray-400 font-bold mt-1 uppercase italic tracking-widest text-center">Sarmiento 2201</p>
        </div>
        <nav class="flex-1 px-4 space-y-1 mt-4">
            <button onclick="showSection('pos')" class="w-full flex items-center p-3 hover:bg-blue-50 rounded-xl transition font-bold text-gray-600"><i class="fas fa-cash-register mr-3 text-blue-500"></i> Ventas</button>
            <button onclick="accesoProtegido('inventory')" class="w-full flex items-center p-3 hover:bg-blue-50 rounded-xl transition font-bold text-gray-600"><i class="fas fa-boxes mr-3 text-blue-500"></i> Inventario</button>
            <button onclick="accesoProtegido('reports')" class="w-full flex items-center p-3 hover:bg-blue-50 rounded-xl transition font-bold text-gray-600"><i class="fas fa-file-invoice-dollar mr-3 text-blue-500"></i> Reportes y Cierre</button>
            <button onclick="accesoProtegido('daily_totals')" class="w-full flex items-center p-3 hover:bg-blue-50 rounded-xl transition font-bold text-gray-600"><i class="fas fa-chart-line mr-3 text-blue-500"></i> Totales Diarios</button>
        </nav>
    </div>

    <div class="flex-1 flex flex-col overflow-hidden">
        <header class="bg-white p-4 shadow-sm border-b flex justify-between items-center px-8">
            <div class="relative w-96">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                <input type="text" id="buscador" onkeyup="filtrarProductos()" placeholder="Buscar producto..." class="w-full pl-10 pr-4 py-2 border rounded-xl font-bold">
            </div>
            <div id="reloj" class="font-black text-gray-400 text-sm text-right"></div>
        </header>
        <main id="main-content" class="flex-1 p-6 overflow-y-auto bg-gray-50"></main>
    </div>

    <script>
        const CLAVE_MAESTRA = "Mupirata1"; 
        const MAIL_RECUPE = "cristianjaviergoncalves@gmail.com";

        let productos = JSON.parse(localStorage.getItem('productos')) || [];
        let historialVentas = JSON.parse(localStorage.getItem('historial_ventas')) || [];
        let gastos = JSON.parse(localStorage.getItem('gastos')) || [];
        let carrito = [];
        let filtroActual = "";
        let metodoPagoActual = "Efectivo";

        function accesoProtegido(seccion) {
            const pass = prompt("ACCESO RESTRINGIDO\nIngrese su contraseña:");
            if (pass === CLAVE_MAESTRA) { showSection(seccion); } 
            else if (pass !== null) { alert("CLAVE INCORRECTA.\n\nRecuperación: " + MAIL_RECUPE); }
        }

        function showSection(name) {
            const container = document.getElementById('main-content');
            if (
